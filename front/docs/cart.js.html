<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cart.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cart.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Vue globale sur le total des achats du tableau 
 */
const arrayGlobalFromProduct = []
quantityArray()
arrayGlobalFromProduct.forEach((item) => (masterGlobalProduct)(item))

/**
 * Fonction qui représente le nombre d'items stockés dans le tableau,
 * une boucle est mise en place pour déterminer la position de l'article ajouter, premier, deuxième etc...  
 */

function quantityArray() {
    const numberItems = localStorage.length
    for (let i = 0; i &lt; numberItems; i++) {
        const keyElement = localStorage.getItem(localStorage.key(i))
        const itemElement = JSON.parse(keyElement)
        arrayGlobalFromProduct.push(itemElement)
    } 
}

/**
 * Fonction qui représente la vue globale du produit, qui est incrémenter d'autres fonctions qui vont lui apporter les données du produit,
 * qui sont la totalité de la balise "article" 
 * @param {object} item Représente un produit
 */

function masterGlobalProduct(item) {
    const article = createBaliseArticle(item)
    const divImage = screenImage(item)
    const cartContent = containerContent(item)

    article.appendChild(divImage)
    article.appendChild(cartContent)
    
    appendArticle(article)
    viewPrice(item)
    viewQuantity(item)
}

/**
 * Fonction qui crée l'élement "article", la classe ".cart__item" lui est attribuer ainsi que la "data-id" et la "data-color"
 * @param {object} item Représente un produit
 * @returns Retourne le contenu de l'article
 */

function createBaliseArticle(item) {
    const article = document.createElement("article")
    article.classList.add("cart__item")
    article.dataset.id = item.id
    article.dataset.colors = item.colors
    return article
}
/**
 * Fonction qui selectionne l'id "#cart__items" pour lui attribuer comme enfant "article"
 * @param {object} article Représente l'article
 */

function appendArticle(article) {
    document.querySelector("#cart__items").appendChild(article)
}

// ===========IMAGE===============

function screenImage(item) {
    const divImage = document.createElement("div")
    divImage.classList.add("cart__item__img")
    const image = document.createElement("img")
    image.src = item.imageUrl
    image.alt = item.altTxt
    divImage.appendChild(image)
    return divImage
}

// ============CONTAINER ITEM / DIV CART__ITEM__CONTENT=========

function containerContent(item) {
    const divContent = document.createElement("div")
    divContent.classList.add("cart__item__content")

    const divDescription = document.createElement("div") 
    divDescription.classList.add("cart__item__content__description")

    //NAME PRODUCT, COLOR, PRICE

    const titleh2 = document.createElement("h2")
    titleh2.textContent = item.name
    const paraColors = document.createElement("p")
    paraColors.textContent = item.colors
    const paraPrice = document.createElement("p")
    paraPrice.textContent = item.price + " €"

    divDescription.appendChild(titleh2)
    divDescription.appendChild(paraColors)
    divDescription.appendChild(paraPrice)
    divContent.appendChild(divDescription)

    // QUANTITY

    const divSettings = document.createElement("div")
    divSettings.classList.add("cart__item__content__settings")

    const divQuantity = document.createElement("div")
    divQuantity.classList.add("cart__item__content__settings__quantity")

    const paraQuantity = document.createElement("p")
    paraQuantity.textContent = "Qté : "
    const inputQuantity = document.createElement("input")
    inputQuantity.setAttribute("type", "number")
    inputQuantity.classList.add("itemQuantity")
    inputQuantity.name = "itemQuantity"
    inputQuantity.min = "1"
    inputQuantity.max = "100"
    inputQuantity.value = item.quantity
    // Utiliser change pour impacter le changement à la souris + clavier
    inputQuantity.addEventListener("change", () => changeQuantity(item.id, inputQuantity.value, item))


    divSettings.appendChild(divQuantity)
    divQuantity.appendChild(paraQuantity)
    divQuantity.appendChild(inputQuantity)
    divContent.appendChild(divSettings)

    // ======================DELETE=============================

    const divDelete = document.createElement("div")
    divDelete.classList.add("cart__item__content__settings__delete")
    divDelete.addEventListener("click", () => deleteItem(item))

    const paraDelete = document.createElement("p")
    paraDelete.classList.add("deleteItem")
    paraDelete.textContent = ("Supprimer")

    divSettings.appendChild(divDelete)
    divDelete.appendChild(paraDelete)

    return divContent    
}

    function deleteItem(item) {
        //Utiliser "findIndex" pour renvoyer le premier élement du tableau
        const itemDelete = arrayGlobalFromProduct.findIndex((product) => product.id === item.id &amp;&amp; product.colors === item.colors)

        //Utiliser splice pour modifier le contenu du tableau "viewCart"
        arrayGlobalFromProduct.splice(itemDelete, 1)

        viewQuantity()
        viewPrice()
        deleteWholeItem(item)
        deleteVisualItem(item)
    }

    function deleteWholeItem(item) {
        const localStoragekey = `${item.id}:${item.colors}`
        // Utiliser "removeItem pour supprimer la clé en argument"
        localStorage.removeItem(localStoragekey)
    }

    function deleteVisualItem(item) {
        // ItemDelete va me chercher l'id et la couleur dans cart.html
        const itemDelete = document.querySelector(`article[data-id="${item.id}"][data-colors="${item.colors}"]`)
        // Utiliser "remove pour supprimer un element"
        itemDelete.remove()
    }

    // ========================QUANTITY TOTAL=================================

    function viewQuantity() {
        let total = 0
        const totalQuantity = document.querySelector("#totalQuantity")
        //Utiliser une loop direct pour executer la quantité total
        arrayGlobalFromProduct.forEach((item) => {
            const totalGlobalQuantity = item.quantity
            total = total + totalGlobalQuantity
        })
        totalQuantity.textContent = total
    }

    // ==========================PRICE TOTAL==============================

    function viewPrice() {
    let total = 0;
    const totalPrice = document.querySelector("#totalPrice")
    //Utiliser une loop direct pour executer le prix total
    arrayGlobalFromProduct.forEach((item) => {
        const totalGlobalPrice = item.price * item.quantity 
        total = total + totalGlobalPrice
    })
    totalPrice.textContent = total
    }

    //===========================UPDATE QUANTITY AND PRICE=================================

    function changeQuantity(id, newValue, item) {
        const changeItem = arrayGlobalFromProduct.find((item) => item.id === id)
        //Utiliser Find pour renvoyer la valeur du premier élement trouvé
        changeItem.quantity = Number(newValue)
        item.quantity = changeItem.quantity
        viewPrice()
        viewQuantity()
        newBasket(item)
    }

    // ============================NEW QUANTITY TO REFRESH PAGE===============================

    function newBasket(item) {
        const newData = JSON.stringify(item)
        const newKey = `${item.id}:${item.colors}`
        //Utiliser setItem pour Maj la clé
        localStorage.setItem(newKey, newData)
    }

    // =============================FORM============================

    const buttonOrder = document.querySelector("#order")
    buttonOrder.addEventListener("click", (e) => formRequest(e))

    function formRequest(e) {
        e.preventDefault()
        // Si le panier est vide la requete POST ne fonctionne pas !
        if (arrayGlobalFromProduct.length === 0) alert("Votre panier est vide !")

        const body = requestControllers()
        // Utiliser Fetch pour envoyer une requete POST 
        fetch("http://localhost:3000/api/products/order", {
            method : "POST",
            body : JSON.stringify(body),
            headers: {
                "Content-Type": "application/json"
            }
        })
            .then((response) => response.json())
            .then((data) => console.log(data)) 
    }

        function requestControllers() {
        // Utiliser HTMLFormElement retourne HTMLFormControlCollection
        // console.log(cartForm.elements)
            const cartForm = document.querySelector(".cart__order__form")
        // On recupere les valeurs du tableau avec value   
            const firstName = cartForm.elements.firstName.value
            const lastName = cartForm.elements.lastName.value
            const address = cartForm.elements.address.value
            const city = cartForm.elements.city.value
            const email = cartForm.elements.email.value
        //Fonction récupérer dans le sous dossier /controllers
            const body = { 
            contact: {
                firstName: firstName,
                lastName: lastName,
                address: address,
                city: city,
                email: email 
            },

            products: idOrders()
             }
             console.log(body)
             return body
        }        

    function idOrders() {
        // On récupère le nombre d'item stockés dans storage
        const numberProducts = localStorage.length
        const arrayProducts = []
        for (let i = 0; i &lt; numberProducts; i++) {
            // On va récupérer la clé dans le storage
            const products = localStorage.key(i);
            // On utilise split pour selectionner uniquement la couleur dans notre id 
            const id = products.split(":")[0]
            // On push ensuite dans le tableau
            arrayProducts.push(id)
        }
        return arrayProducts
    }</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addProductValid">addProductValid</a></li><li><a href="global.html#allDataFromProduct">allDataFromProduct</a></li><li><a href="global.html#appendArticle">appendArticle</a></li><li><a href="global.html#arrayGlobalFromProduct">arrayGlobalFromProduct</a></li><li><a href="global.html#articleComponents">articleComponents</a></li><li><a href="global.html#buildDescription">buildDescription</a></li><li><a href="global.html#buildImage">buildImage</a></li><li><a href="global.html#buildTitle">buildTitle</a></li><li><a href="global.html#button">button</a></li><li><a href="global.html#buyCLick">buyCLick</a></li><li><a href="global.html#createBaliseArticle">createBaliseArticle</a></li><li><a href="global.html#importColors">importColors</a></li><li><a href="global.html#importDescription">importDescription</a></li><li><a href="global.html#importImage">importImage</a></li><li><a href="global.html#importPrice">importPrice</a></li><li><a href="global.html#importTitle">importTitle</a></li><li><a href="global.html#itemsArticle">itemsArticle</a></li><li><a href="global.html#linkElement">linkElement</a></li><li><a href="global.html#masterGlobalProduct">masterGlobalProduct</a></li><li><a href="global.html#orderInvalid">orderInvalid</a></li><li><a href="global.html#orderStorage">orderStorage</a></li><li><a href="global.html#previewKanapArticle">previewKanapArticle</a></li><li><a href="global.html#quantityArray">quantityArray</a></li><li><a href="global.html#urlParams">urlParams</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Jan 18 2022 21:43:52 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
